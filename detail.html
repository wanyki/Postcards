<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ˜ä¿¡ç‰‡è¯¦æƒ… ğŸ“®</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --success-color: #2ec4b6;
            --info-color: #3a86ff;
            --bg-color: #f0f2f5;
        }

        body { background-color: var(--bg-color); padding: 40px 0; font-family: "Segoe UI", "Microsoft YaHei", sans-serif; }

        /* ä¸»è¯¦æƒ…å¡ç‰‡ */
        .detail-card { 
            background: white; 
            border-radius: 24px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.08); 
            padding: 30px; 
            border: 1px solid rgba(255,255,255,0.8);
            overflow: hidden;
        }

        /* å›¾ç‰‡å®¹å™¨ç¾åŒ– */
        .img-container {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            background: #f8f9fa;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.05);
        }

        .detail-img { 
            width: 100%; 
            max-height: 500px; 
            object-fit: contain; 
            cursor: zoom-in; 
            transition: transform 0.3s;
        }
        .detail-img:hover { transform: scale(1.02); }

        /* ä¿¡æ¯æ–‡å­—ç¾åŒ– */
        .info-label { font-size: 0.85rem; color: #6c757d; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 0.5px; }
        .info-value { font-size: 1.05rem; font-weight: 500; color: #2d3436; margin-bottom: 15px; }
        .region-title { font-size: 2rem; font-weight: 800; color: #1e272e; margin-bottom: 20px; border-bottom: 3px solid var(--primary-color); display: inline-block; padding-bottom: 5px; }

        /* æ ‡ç­¾ç¾åŒ– */
        .tag-badge { 
            padding: 6px 14px; 
            border-radius: 10px; 
            font-weight: 500; 
            background: #e9ecef; 
            color: #495057; 
            margin-right: 8px; 
            margin-bottom: 8px; 
            border: none;
            transition: all 0.2s;
        }
        .tag-badge:hover { background: var(--primary-color); color: white; }

        /* åº•éƒ¨ç›¸å…³å¡ç‰‡ç¾åŒ– (åŒæ­¥é¦–é¡µæ ·å¼) */
        .postcard-item { transition: all 0.4s; border-radius: 18px; overflow: hidden; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: none; }
        .postcard-item:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0,0,0,0.1); }
        .postcard-mini-img { width: 100%; height: 160px; object-fit: cover; }

        /* å…¨å±æ¨¡æ€æ¡† */
        .image-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .image-modal-backdrop img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            border-radius: 5px;
        }

        .stats-card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }

        [v-cloak] { display: none !important; }
    </style>
</head>
<body>
<div id="app" class="container" v-cloak>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold mb-0">
            <span class="me-2">ğŸ“®</span> æ˜ä¿¡ç‰‡è¯¦æƒ…
        </h4>
        <a href="index.html" class="btn btn-light shadow-sm px-4 rounded-pill">
            <i class="bi bi-arrow-left"></i> è¿”å›ä¸»é¡µ
        </a>
    </div>

    <div id="detail-container">
        </div>

    <div class="stats-card mt-5">
        <h6 class="fw-bold mb-3">ğŸ” å¿«é€Ÿç­›é€‰ç›¸å…³æ”¶è—</h6>
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label small text-muted">æ‰€åœ¨çœä»½</label>
                <select v-model="filterProvince" class="form-select border-0 bg-light" @change="filterCity = ''">
                    <option value="">æ‰€æœ‰çœä»½</option>
                    <option v-for="p in provinces" :value="p">{{ p }}</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label small text-muted">ç±»åˆ«</label>
                <select v-model="filterType" class="form-select border-0 bg-light">
                    <option value="">æ‰€æœ‰ç±»å‹</option>
                    <option value="æ”¶åˆ°">ğŸ“¥ æ”¶åˆ°</option>
                    <option value="å¯„å‡º">ğŸ“¤ å¯„å‡º</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label small text-muted">æ ‡ç­¾æœç´¢</label>
                <input v-model="filterTag" type="text" class="form-control border-0 bg-light" placeholder="æœç´¢ç›¸å…³æ ‡ç­¾...">
            </div>
            <div class="col-md-2 text-end">
                <span class="badge bg-primary-subtle text-primary p-2 w-100">åº“ä¸­å…± {{ postcards.length }} å¼ </span>
            </div>
        </div>
    </div>

    <div class="row mt-4 g-4" v-if="hasFilter">
        <div class="col-12 mb-2"><h6 class="fw-bold">åŒ¹é…åˆ°çš„å…¶ä»–æ˜ä¿¡ç‰‡ï¼š</h6></div>
        <div class="col-xl-3 col-lg-4 col-md-6" v-for="card in filteredCards" :key="card.id">
            <a :href="'detail.html?id=' + encodeURIComponent(card.id)" class="text-decoration-none text-reset">
                <div class="postcard-item h-100">
                    <img :src="card.imgFront" class="postcard-mini-img" loading="lazy">
                    <div class="p-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-light text-dark border">{{ card.type }}</span>
                            <small class="text-muted font-monospace">{{ card.id }}</small>
                        </div>
                        <h6 class="fw-bold text-truncate mb-1">{{ card.region }}</h6>
                        <p class="small text-muted mb-0">{{ card.sendDate || card.receiveDate || 'â€”' }}</p>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

<div id="imgModal" class="image-modal-backdrop" onclick="closeImageModal()">
    <img id="imgModalImg" src="" alt="é¢„è§ˆå¤§å›¾">
    <div class="text-white position-absolute bottom-0 mb-4">ç‚¹å‡»ä»»æ„å¤„å…³é—­</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
<script src="data.js"></script>
<script src="app.js"></script>
<script>
    function getQueryId() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
    }

    function renderDetail() {
        const id = getQueryId();
        const container = document.getElementById('detail-container');

        if (!id || !Array.isArray(postcardData)) {
            container.innerHTML = '<div class="alert alert-danger shadow-sm">æœªæ‰¾åˆ°æ˜ä¿¡ç‰‡ä¿¡æ¯ã€‚</div>';
            return;
        }

        const card = postcardData.find(c => c.id === id);
        if (!card) {
            container.innerHTML = '<div class="alert alert-warning shadow-sm">æ²¡æœ‰æ‰¾åˆ°ç¼–å·ä¸º ' + id + ' çš„æ˜ä¿¡ç‰‡ã€‚</div>';
            return;
        }

        const tags = Array.isArray(card.tags) ? card.tags : [];

        // åŠ¨æ€ç”Ÿæˆè¯¦æƒ…å†…å®¹
        container.innerHTML = `
            <div class="detail-card">
                <div class="row g-5">
                    <div class="col-lg-7">
                        <div class="img-container">
                            <img class="detail-img" src="${card.imgFront}" alt="æ˜ä¿¡ç‰‡æ­£é¢" onclick="openImageModal('${card.imgFront}')" title="ç‚¹å‡»æ”¾å¤§å›¾ç‰‡">
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="ps-lg-3">
                            <span class="badge ${card.type === 'æ”¶åˆ°' ? 'bg-success' : 'bg-primary'} mb-2 px-3 py-2 rounded-pill">${card.type === 'æ”¶åˆ°' ? 'ğŸ“¥ æ”¶åˆ°' : 'ğŸ“¤ å¯„å‡º'}</span>
                            <h2 class="region-title d-block">${card.region}</h2>
                            
                            <div class="row mb-4">
                                <div class="col-6">
                                    <div class="info-label">ç»Ÿä¸€ç¼–å·</div>
                                    <div class="info-value font-monospace text-primary">${card.id}</div>
                                </div>
                                <div class="col-6">
                                    <div class="info-label">æ¥æºå¹³å°</div>
                                    <div class="info-value">${card.platform || 'â€”'}</div>
                                </div>
                                <div class="col-6">
                                    <div class="info-label">æ—¶é—´</div>
                                    <div class="info-value">${card.sendDate || card.receiveDate || card.date || 'â€”'}</div>
                                </div>
                                <div class="col-6">
                                    <div class="info-label">å…³è”äºº</div>
                                    <div class="info-value">${card.person || 'â€”'}</div>
                                </div>
                            </div>

                            <div class="info-label">å¿ƒæƒ…ä¸æ•…äº‹</div>
                            <p class="text-secondary mb-4" style="line-height: 1.8; white-space: pre-line;">${card.note || 'æŒä¿¡äººå¾ˆæ‡’ï¼Œè¿˜æ²¡æœ‰å†™ä¸‹è¿™æ®µè¶³è¿¹çš„æ•…äº‹...'}</p>
                            
                            <div class="info-label mb-2">ä¸ªæ€§åŒ–æ ‡ç­¾</div>
                            <div class="d-flex flex-wrap">
                                ${tags.length ? tags.map(t => `<span class="tag-badge"># ${t}</span>`).join('') : '<span class="text-muted small">æš‚æ— æ ‡ç­¾</span>'}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function openImageModal(src) {
        const modal = document.getElementById('imgModal');
        const img = document.getElementById('imgModalImg');
        img.src = src;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
    }

    function closeImageModal() {
        const modal = document.getElementById('imgModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto'; 
    }

    renderDetail();
</script>
</body>
</html>