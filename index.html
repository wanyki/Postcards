<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ˜ä¿¡ç‰‡è¶³è¿¹ ğŸ“®</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --success: #2ec4b6;
            --info: #3a86ff;
            --warning: #ff9f1c;
            --bg: #f0f2f5;
        }

        body {
            background-color: var(--bg);
            font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
            color: #2b2d42;
            padding-bottom: 50px;
        }

        /* é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ */
        .stat-container { display: flex; gap: 20px; margin-bottom: 25px; margin-top: 20px; }
        .stat-card {
            flex: 1;
            background: white;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.03);
            border: 1px solid rgba(255,255,255,0.8);
        }
        .stat-icon {
            width: 50px; height: 50px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center; font-size: 1.4rem;
        }
        .stat-info .label { font-size: 0.75rem; color: #8d99ae; font-weight: 600; text-transform: uppercase; }
        .stat-info .value { font-size: 1.5rem; font-weight: 800; display: block; }

        /* ä¸»ä½“å¸ƒå±€æ§åˆ¶ */
        .main-grid { display: flex; gap: 24px; align-items: flex-start; }
        .content-left { flex: 1; min-width: 0; } /* å…³é”®ï¼šé˜²æ­¢ Echarts æº¢å‡º */
        .sidebar-right { width: 340px; flex-shrink: 0; position: sticky; top: 20px; }

        /* åœ°å›¾å¡ç‰‡ */
        .map-card {
            background: white; border-radius: 24px; padding: 24px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05); margin-bottom: 30px;
        }
        #map-container { width: 100%; height: 500px; border-radius: 16px; }

        /* ä¾§è¾¹ç­›é€‰å™¨ */
        .filter-card {
            background: #fff; border-radius: 24px; padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.02);
        }
        .filter-title { font-weight: 800; font-size: 1.1rem; margin-bottom: 20px; color: #1a1c2c; }
        .form-label { font-weight: 700; font-size: 0.8rem; color: #4a4e69; margin-bottom: 6px; }
        .form-control, .form-select {
            border-radius: 12px; border: 1px solid #edf2f7; background: #f8fafc;
            padding: 10px 15px; font-size: 0.9rem; transition: all 0.2s;
        }
        .form-control:focus { background: white; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1); }

        /* ç”»å»Šé¡¹ç›® */
        .postcard-item {
            background: white; border-radius: 22px; overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid #f1f5f9; position: relative; height: 100%;
        }
        .postcard-item:hover { transform: translateY(-8px); box-shadow: 0 20px 30px rgba(0,0,0,0.08); }
        .postcard-img { width: 100%; height: 200px; object-fit: cover; }
        .card-body { padding: 18px; }
        .card-tag {
            position: absolute; top: 12px; right: 12px; padding: 5px 12px;
            border-radius: 12px; font-size: 0.7rem; font-weight: 800; color: white;
            z-index: 2;
        }

        /* æŒ‰é’® */
        .btn-reset-large {
            background: #f8fafc; color: #64748b; border: 1px solid #e2e8f0;
            padding: 12px; border-radius: 14px; font-weight: 700; width: 100%;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-reset-large:hover { background: #fee2e2; color: #ef476f; border-color: #fecaca; }
        
        .btn-load-more {
            background: white; color: var(--primary); border: 2px solid var(--primary);
            padding: 12px 40px; border-radius: 15px; font-weight: 700; transition: all 0.2s;
        }
        .btn-load-more:hover { background: var(--primary); color: white; }

        [v-cloak] { display: none !important; }

        @media (max-width: 992px) {
            .main-grid { flex-direction: column; }
            .sidebar-right { width: 100%; position: static; }
            .stat-container { flex-wrap: wrap; }
        }
    </style>
</head>
<body>

<div id="app" class="container-fluid px-lg-5" v-cloak>
    <div class="stat-container">
        <div class="stat-card">
            <div class="stat-icon" style="background: rgba(67, 97, 238, 0.1); color: var(--primary);"><i class="fa-solid fa-layer-group"></i></div>
            <div class="stat-info"><span class="label">Total</span><span class="value">{{ postcards.length }}</span></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background: rgba(46, 196, 182, 0.1); color: var(--success);"><i class="fa-solid fa-inbox"></i></div>
            <div class="stat-info"><span class="label">Received</span><span class="value">{{ stats.receiveCount }}</span></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background: rgba(58, 134, 255, 0.1); color: var(--info);"><i class="fa-solid fa-paper-plane"></i></div>
            <div class="stat-info"><span class="label">Sent</span><span class="value">{{ stats.sendCount }}</span></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background: rgba(255, 159, 28, 0.1); color: var(--warning);"><i class="fa-solid fa-earth-asia"></i></div>
            <div class="stat-info"><span class="label">Regions</span><span class="value">{{ stats.countryCount }}</span></div>
        </div>
    </div>

    <div class="main-grid">
        <div class="content-left">
            <div class="map-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="fw-800 m-0"><i class="fa-solid fa-map-marked-alt me-2 text-primary"></i>è¶³è¿¹çƒ­åŠ›åˆ†å¸ƒ</h5>
                    <div class="btn-group btn-group-sm rounded-pill overflow-hidden border">
                        <button class="btn px-4" :class="mapType === 'china' ? 'btn-primary' : 'btn-light'" @click="toggleMap('china')">å›½å†…</button>
                        <button class="btn px-4" :class="mapType === 'world' ? 'btn-primary' : 'btn-light'" @click="toggleMap('world')">å…¨çƒ</button>
                    </div>
                </div>
                <div id="map-container"></div>
            </div>

            <div class="d-flex justify-content-between align-items-end mb-4 px-2">
                <h4 class="fw-800 m-0">ğŸ–¼ï¸ è®°å¿†ç”»å»Š <small class="text-muted fs-6 fw-normal ms-2">Matching {{ totalFilteredCount }} items</small></h4>
            </div>

            <div class="row g-4">
                <div class="col-sm-6 col-xl-4" v-for="card in displayCards" :key="card.id">
                    <a :href="'detail.html?id=' + encodeURIComponent(card.id)" target="_blank" class="text-decoration-none text-reset">
                        <div class="postcard-item">
                            <div class="card-tag shadow-sm" :style="{background: card.type=='æ”¶åˆ°'?'var(--success)':'var(--info)'}">{{ card.type }}</div>
                            <img :src="card.imgFront" class="postcard-img" loading="lazy">
                            <div class="card-body">
                                <h6 class="fw-800 text-truncate mb-1">{{ card.region }}</h6>
                                <div class="d-flex justify-content-between align-items-center small text-muted">
                                    <span><i class="fa-regular fa-calendar me-1"></i>{{ card.receiveDate || card.sendDate || 'â€”' }}</span>
                                    <span class="badge bg-light text-dark font-monospace">{{ card.id }}</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <div v-if="displayCount < totalFilteredCount" class="text-center mt-5 mb-5">
                <button class="btn btn-load-more" @click="displayCount += 12">åŠ è½½æ›´å¤šç²¾å½©</button>
            </div>
        </div>

        <div class="sidebar-right">
            <div class="filter-card">
                <div class="filter-title"><i class="fa-solid fa-filter me-2 text-primary"></i>ç­›é€‰ä¸æ’åº</div>
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">ç¼–å·æœç´¢</label>
                        <input v-model="filterId" type="text" class="form-control" placeholder="è¾“å…¥ ID...">
                    </div>
                    <div class="col-12">
                        <label class="form-label">å…³é”®è¯ / æ ‡ç­¾</label>
                        <input v-model="filterTag" type="text" class="form-control" placeholder="æœç´¢å†…å®¹ã€åœ°ç‚¹...">
                    </div>
                    <div class="col-6">
                        <label class="form-label">çœä»½</label>
                        <select v-model="filterProvince" class="form-select" @change="filterCity=''"><option value="">å…¨éƒ¨</option><option v-for="p in provinces" :value="p">{{p}}</option></select>
                    </div>
                    <div class="col-6">
                        <label class="form-label">åŸå¸‚</label>
                        <select v-model="filterCity" class="form-select" :disabled="!filterProvince"><option value="">å…¨éƒ¨</option><option v-for="c in availableCities" :value="c">{{c}}</option></select>
                    </div>
                    <div class="col-6">
                        <label class="form-label">å¹³å°</label>
                        <select v-model="filterPlatform" class="form-select"><option value="">å…¨éƒ¨</option><option v-for="p in platforms" :value="p">{{p}}</option></select>
                    </div>
                    <div class="col-6">
                        <label class="form-label">æ”¶å¯„</label>
                        <select v-model="filterType" class="form-select"><option value="">å…¨éƒ¨</option><option value="æ”¶åˆ°">ğŸ“¥ æ”¶åˆ°</option><option value="å¯„å‡º">ğŸ“¤ å¯„å‡º</option></select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">æ’åº</label>
                        <select v-model="sortBy" class="form-select">
                            <option value="id_desc">æŒ‰ç¼–å· (æ–°â†’æ—§)</option>
                            <option value="id_asc">æŒ‰ç¼–å· (æ—§â†’æ–°)</option>
                            <option value="date_desc">æŒ‰æ—¥æœŸ (æœ€è¿‘ä¼˜å…ˆ)</option>
                        </select>
                    </div>
                    <div class="col-12 mt-4 pt-3 border-top">
                        <button class="btn btn-reset-large" @click="resetAll">
                            <i class="fa-solid fa-arrows-rotate"></i> é‡ç½®æ‰€æœ‰ç­›é€‰
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/map/js/china.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
<script src="cityData.js"></script>
<script src="data.js"></script>
<script src="app.js"></script>
</body>
</html>